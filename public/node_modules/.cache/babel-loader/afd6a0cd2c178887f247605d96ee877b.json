{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Makaru\\\\Documents\\\\React Project\\\\broowingcoffee-web-server\\\\src\\\\pages\\\\ResetPassword\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useReducer, useState } from 'react';\nimport { useHistory, useParams } from 'react-router-dom';\nimport { ErrorPage, LoadingPage, SuccessPage } from 'pages';\nimport { Text, TextInput, View, Separator, Button } from 'components';\nimport styles from './.module.css';\nimport { resetPassword as resetPasswordReducer, resetPasswordInitState } from 'hooks';\nimport { hasLowerCaseLetter, hasNumber, hasSymbol, hasUpperCaseLetter } from 'utils/checker';\nimport { server } from 'network/service';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function HomePage() {\n  _s();\n\n  const {\n    token\n  } = useParams();\n  const history = useHistory();\n  const [state, setState] = useReducer(resetPasswordReducer, resetPasswordInitState);\n  useEffect(() => {\n    server.peek('/reset-password-auth', {\n      headers: {\n        'reset-auth-token': token\n      }\n    }).then(res => {\n      const {\n        res: {\n          email,\n          token\n        },\n        status\n      } = res;\n\n      if (status) {\n        setState({\n          type: 'set',\n          authRequest: 'success',\n          email,\n          token\n        });\n      }\n    }).catch(err => {\n      setState({\n        type: 'set',\n        authRequest: 'failed'\n      });\n    });\n  }, []);\n\n  const strength = val => {\n    let strength = 0;\n\n    if (hasUpperCaseLetter(val)) {\n      if (val.length > 2) {\n        strength += 15;\n      }\n\n      strength += 10;\n    }\n\n    if (hasLowerCaseLetter(val)) {\n      if (val.length > 4) {\n        strength += 15;\n      }\n\n      strength += 10;\n    }\n\n    if (hasSymbol(val)) {\n      if (val.length > 6) {\n        strength += 15;\n      }\n\n      strength += 10;\n    }\n\n    if (hasNumber(val)) {\n      if (val.length > 8) {\n        strength += 15;\n      }\n\n      strength += 10;\n    }\n\n    return strength;\n  };\n\n  const onChangeText = (component, val) => {\n    if (component === 'new-password') {\n      setState({\n        type: 'set',\n        newPassword: val,\n        passwordStrength: strength(val),\n        isMatched: val === state.confirmPassword\n      });\n      return;\n    }\n\n    if (component === 'confirm-password') {\n      setState({\n        type: 'set',\n        confirmPassword: val,\n        isMatched: val === state.newPassword\n      });\n      return;\n    }\n  };\n\n  const onClickChange = () => {\n    if (!state.isMatched) {\n      setState({\n        type: 'set',\n        resetRequest: 'failed',\n        messageRequest: 'Passwords does not matched'\n      });\n      return;\n    }\n\n    setState({\n      type: 'set',\n      isLoading: true\n    });\n    server.push('/reset-password-decoder', {\n      email: state.email,\n      newPassword: state.newPassword\n    }, {\n      headers: {\n        'reset-auth-token': state.token\n      }\n    }).then(res => {\n      setState({\n        type: 'set',\n        authRequest: 'success-done',\n        isLoading: false\n      });\n      setTimeout(() => {\n        history.replace('/');\n      }, 2000);\n    }).catch(({\n      err\n    }) => {\n      if (err.includes('Password')) {\n        console.log(err);\n        setState({\n          type: 'set',\n          resetRequest: 'failed',\n          messageRequest: err\n        });\n        return;\n      }\n\n      setState({\n        type: 'set',\n        authRequest: 'failed'\n      });\n    });\n  };\n\n  if (state.authRequest === 'success') {\n    return /*#__PURE__*/_jsxDEV(View, {\n      style: styles.mainPane,\n      children: [/*#__PURE__*/_jsxDEV(View, {\n        style: styles.topPane,\n        children: /*#__PURE__*/_jsxDEV(View, {\n          style: styles.headerPane,\n          children: [/*#__PURE__*/_jsxDEV(Text, {\n            style: styles.title,\n            children: \"New Password\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Separator, {\n            vertical: 0.25\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 129,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Text, {\n            style: styles.subtitle,\n            children: \"Please be sure, the password you enter was not leaked to anyone\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 130,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(View, {\n        style: styles.bodyPane,\n        children: [/*#__PURE__*/_jsxDEV(TextInput, {\n          skinStyle: styles.inputSkin,\n          placeholder: \"New Password\",\n          showIndicator: true,\n          indicatorProgress: state.passwordStrength,\n          isTextEncrypt: state.isEncrypt,\n          value: state.newPassword,\n          onChangeText: text => onChangeText('new-password', text)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Separator, {\n          vertical: 0.5\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(TextInput, {\n          skinStyle: styles.inputSkin,\n          placeholder: \"Confirm Password\",\n          isTextEncrypt: state.isEncrypt,\n          onTextEncrypt: () => setState({\n            type: 'set',\n            isEncrypt: !state.isEncrypt\n          }),\n          value: state.confirmPassword,\n          onChangeText: text => onChangeText('confirm-password', text)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Separator, {\n          vertical: 1\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          style: styles.button,\n          isLoading: state.isLoading,\n          title: \"Change\",\n          onClick: onClickChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(View, {\n        style: styles.bottomPane,\n        children: [state.resetRequest === 'failed' && /*#__PURE__*/_jsxDEV(View, {\n          style: styles.errorPane,\n          children: /*#__PURE__*/_jsxDEV(Text, {\n            style: styles.errorTitle,\n            children: state.messageRequest\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 13\n        }, this), state.resetRequest === 'success' && /*#__PURE__*/_jsxDEV(View, {\n          style: styles.infoPane,\n          children: /*#__PURE__*/_jsxDEV(Text, {\n            style: styles.infoTitle,\n            children: state.messageRequest\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 170,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 7\n    }, this);\n  }\n\n  if (state.authRequest === 'success-done') {\n    return /*#__PURE__*/_jsxDEV(SuccessPage, {\n      title: \"Password Saved\",\n      subtitle: \"You may now use the new password you entered\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 7\n    }, this);\n  }\n\n  if (state.authRequest === 'failed') {\n    return /*#__PURE__*/_jsxDEV(ErrorPage, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 12\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(LoadingPage, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 191,\n    columnNumber: 10\n  }, this);\n}\n\n_s(HomePage, \"KG/RpU1ejJ3Nfj/0QjKc4HRNqqs=\", false, function () {\n  return [useParams, useHistory];\n});\n\n_c = HomePage;\n\nvar _c;\n\n$RefreshReg$(_c, \"HomePage\");","map":{"version":3,"sources":["C:/Users/Makaru/Documents/React Project/broowingcoffee-web-server/src/pages/ResetPassword/index.js"],"names":["useEffect","useReducer","useState","useHistory","useParams","ErrorPage","LoadingPage","SuccessPage","Text","TextInput","View","Separator","Button","styles","resetPassword","resetPasswordReducer","resetPasswordInitState","hasLowerCaseLetter","hasNumber","hasSymbol","hasUpperCaseLetter","server","HomePage","token","history","state","setState","peek","headers","then","res","email","status","type","authRequest","catch","err","strength","val","length","onChangeText","component","newPassword","passwordStrength","isMatched","confirmPassword","onClickChange","resetRequest","messageRequest","isLoading","push","setTimeout","replace","includes","console","log","mainPane","topPane","headerPane","title","subtitle","bodyPane","inputSkin","isEncrypt","text","button","bottomPane","errorPane","errorTitle","infoPane","infoTitle"],"mappings":"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","sourcesContent":["import {useEffect, useReducer, useState} from 'react';\r\nimport {useHistory, useParams} from 'react-router-dom';\r\nimport {ErrorPage, LoadingPage, SuccessPage} from 'pages';\r\nimport {Text, TextInput, View, Separator, Button} from 'components';\r\nimport styles from './.module.css';\r\nimport {resetPassword as resetPasswordReducer, resetPasswordInitState} from 'hooks';\r\nimport {\r\n  hasLowerCaseLetter,\r\n  hasNumber,\r\n  hasSymbol,\r\n  hasUpperCaseLetter,\r\n} from 'utils/checker';\r\nimport {server} from 'network/service';\r\n\r\nexport default function HomePage() {\r\n  const {token} = useParams();\r\n  const history = useHistory();\r\n  const [state, setState] = useReducer(resetPasswordReducer, resetPasswordInitState);\r\n\r\n  useEffect(() => {\r\n    server\r\n      .peek('/reset-password-auth', {\r\n        headers: {'reset-auth-token': token},\r\n      })\r\n      .then(res => {\r\n        const {\r\n          res: {email, token},\r\n          status,\r\n        } = res;\r\n        if (status) {\r\n          setState({type: 'set', authRequest: 'success', email, token});\r\n        }\r\n      })\r\n      .catch(err => {\r\n        setState({type: 'set', authRequest: 'failed'});\r\n      });\r\n  }, []);\r\n\r\n  const strength = val => {\r\n    let strength = 0;\r\n    if (hasUpperCaseLetter(val)) {\r\n      if (val.length > 2) {\r\n        strength += 15;\r\n      }\r\n      strength += 10;\r\n    }\r\n    if (hasLowerCaseLetter(val)) {\r\n      if (val.length > 4) {\r\n        strength += 15;\r\n      }\r\n      strength += 10;\r\n    }\r\n    if (hasSymbol(val)) {\r\n      if (val.length > 6) {\r\n        strength += 15;\r\n      }\r\n      strength += 10;\r\n    }\r\n    if (hasNumber(val)) {\r\n      if (val.length > 8) {\r\n        strength += 15;\r\n      }\r\n      strength += 10;\r\n    }\r\n    return strength;\r\n  };\r\n  const onChangeText = (component, val) => {\r\n    if (component === 'new-password') {\r\n      setState({\r\n        type: 'set',\r\n        newPassword: val,\r\n        passwordStrength: strength(val),\r\n        isMatched: val === state.confirmPassword,\r\n      });\r\n      return;\r\n    }\r\n    if (component === 'confirm-password') {\r\n      setState({\r\n        type: 'set',\r\n        confirmPassword: val,\r\n        isMatched: val === state.newPassword,\r\n      });\r\n      return;\r\n    }\r\n  };\r\n\r\n  const onClickChange = () => {\r\n    if (!state.isMatched) {\r\n      setState({\r\n        type: 'set',\r\n        resetRequest: 'failed',\r\n        messageRequest: 'Passwords does not matched',\r\n      });\r\n      return;\r\n    }\r\n\r\n    setState({type: 'set', isLoading: true});\r\n    server\r\n      .push(\r\n        '/reset-password-decoder',\r\n        {\r\n          email: state.email,\r\n          newPassword: state.newPassword,\r\n        },\r\n        {headers: {'reset-auth-token': state.token}},\r\n      )\r\n      .then(res => {\r\n        setState({type: 'set', authRequest: 'success-done', isLoading: false});\r\n        setTimeout(() => {\r\n          history.replace('/');\r\n        }, 2000);\r\n      })\r\n      .catch(({err}) => {\r\n        if (err.includes('Password')) {\r\n          console.log(err);\r\n          setState({type: 'set', resetRequest: 'failed', messageRequest: err});\r\n          return;\r\n        }\r\n        setState({type: 'set', authRequest: 'failed'});\r\n      });\r\n  };\r\n\r\n  if (state.authRequest === 'success') {\r\n    return (\r\n      <View style={styles.mainPane}>\r\n        <View style={styles.topPane}>\r\n          <View style={styles.headerPane}>\r\n            <Text style={styles.title}>New Password</Text>\r\n            <Separator vertical={0.25} />\r\n            <Text style={styles.subtitle}>\r\n              Please be sure, the password you enter was not leaked to anyone\r\n            </Text>\r\n          </View>\r\n        </View>\r\n        <View style={styles.bodyPane}>\r\n          <TextInput\r\n            skinStyle={styles.inputSkin}\r\n            placeholder='New Password'\r\n            showIndicator={true}\r\n            indicatorProgress={state.passwordStrength}\r\n            isTextEncrypt={state.isEncrypt}\r\n            value={state.newPassword}\r\n            onChangeText={text => onChangeText('new-password', text)}\r\n          />\r\n          <Separator vertical={0.5} />\r\n          <TextInput\r\n            skinStyle={styles.inputSkin}\r\n            placeholder='Confirm Password'\r\n            isTextEncrypt={state.isEncrypt}\r\n            onTextEncrypt={() => setState({type: 'set', isEncrypt: !state.isEncrypt})}\r\n            value={state.confirmPassword}\r\n            onChangeText={text => onChangeText('confirm-password', text)}\r\n          />\r\n          <Separator vertical={1} />\r\n          <Button\r\n            style={styles.button}\r\n            isLoading={state.isLoading}\r\n            title='Change'\r\n            onClick={onClickChange}\r\n          />\r\n        </View>\r\n        <View style={styles.bottomPane}>\r\n          {state.resetRequest === 'failed' && (\r\n            <View style={styles.errorPane}>\r\n              <Text style={styles.errorTitle}>{state.messageRequest}</Text>\r\n            </View>\r\n          )}\r\n          {state.resetRequest === 'success' && (\r\n            <View style={styles.infoPane}>\r\n              <Text style={styles.infoTitle}>{state.messageRequest}</Text>\r\n            </View>\r\n          )}\r\n        </View>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  if (state.authRequest === 'success-done') {\r\n    return (\r\n      <SuccessPage\r\n        title='Password Saved'\r\n        subtitle='You may now use the new password you entered'\r\n      />\r\n    );\r\n  }\r\n\r\n  if (state.authRequest === 'failed') {\r\n    return <ErrorPage />;\r\n  }\r\n\r\n  return <LoadingPage />;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}